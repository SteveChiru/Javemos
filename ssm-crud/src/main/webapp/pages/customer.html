<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CRM-客户关系管理</title>
</head>
<body>
    <!--查询栏-->
    <div>
        <label>客户管理</label>
    </div>
   <div>
       <label>客户名称</label>
       <input type="text" id="customerName" name="custName">
       <label>客户来源</label>
       <select id="customerFrom" name="custSource">
            <option value="">--请选择--</option>
       </select>
       <label>所属行业</label>
       <select id="custIndustry" name="custIndustory">
            <option value="">--请选择--</option>
       </select>
       <label>客户级别</label>
       <select id="custLevel" name="custLevel">
            <option value="">--请选择--</option>
       </select>
       <button>查询</button>
   </div>
    <hr>
    <!--信息展示栏-->
    <div>
        <div>客户信息列表</div>
        <div>
            <table id="listcustomer">
                <thead>
                <th>ID</th>
                <th>客户名称</th>
                <th>客户来源</th>
                <th>客户所属行业</th>
                <th>客户级别</th>
                <th>固定电话</th>
                <th>手机</th>
                <th>操作</th>
                </thead>
                <tbody>
                <!--获取contorller发送的数据后进行处理-->

                </tbody>
            </table>
        </div>
    </div>

    <!--修改对话框-->
    <div class="modal fade" id="customerEditDialog" role="dialog" tabindex="-1" aria-labelledby="myModalLabel">
        <div role="document">
            修改客户信息
        </div>

    </div>

    <script type="text/javascript" src="../js/jquery-1.8.3.min.js"></script>
    <script type="text/javascript">
        //加载初始化的字典数据到下拉列表
        function loadDictData() {
            $.ajax({
                type:"get",
                url:"http://localhost:8080/dict/load.action",
                success:function (data) {
                    // alert("加载字典数据");
                    //添加客户来源数据
                    var custSourceList = data.custSourceInit;
                    for (var i = custSourceList.length - 1; i >= 0; i--) {
                        $("#customerFrom").prepend('<option value="'+custSourceList[i].dict_id+'">'+custSourceList[i].dict_item_name+'</option>>');
                     };

                    //添加客户行业数据
                    var custIndustryList = data.custIndustryInit;
                    for (var i = custIndustryList.length - 1; i >= 0; i--) {
                        $("#custIndustry").prepend('<option value="'+custIndustryList[i].dict_id+'">'+custIndustryList[i].dict_item_name+'</option>>');
                    };

                    //添加客户等级数据
                    var custLevelList = data.custLevelInit;
                    for (var i = custLevelList.length - 1; i >= 0; i--) {
                        $("#custLevel").prepend('<option value="'+custLevelList[i].dict_id+'">'+custLevelList[i].dict_item_name+'</option>>');
                    };
                }
            });
        }

        //获取所有客户的信息
        function listCustomers(){
            //alert("获得所有用户信息");
            $.ajax({
                type:"get",
                url:"http://localhost:8080/customer/list.action",
                data:{"page":1,"rows":5},
                success:function (data) {
                    //alert("获得用户信息待处理");
                    var customers = data.rows;
                    for (var i=0;i<customers.length;i++){
                        $("#listcustomer").append("<tr>" +
                            "<td>"+customers[i].cust_id+"</td>" +
                            "<td>"+customers[i].cust_name+"</td>" +
                            "<td>"+customers[i].cust_source+"</td>" +
                            "<td>"+customers[i].cust_industry+"</td>" +
                            "<td>"+customers[i].cust_level+"</td>" +
                            "<td>"+customers[i].cust_phone+"</td>" +
                            "<td>"+customers[i].cust_mobile+"</td>" +
                            "<td>"+customers[i].cust_createtime+"</td>" +
                            '<td><a href="#" data-toggle="modal" data-target="#customerEditDialog">修改</a>&nbsp&nbsp<a href="#" >删除</a></td>' +
                            "</tr>")
                    }

                }
            });
        }

        //页面加载完要执行的方法
        $(function () {
            loadDictData();
            listCustomers();
        });

    </script>
</body>
</html>